// Generated by CoffeeScript 1.3.3
(function() {
  var Prelude;

  Prelude = (function() {

    function Prelude(container, width, height) {
      this.container = container;
      this.width = width;
      this.height = height;
      this.layers = [];
      this.initStage();
      this.initTracks();
    }

    Prelude.prototype.initStage = function() {
      this.stage = new Stage(10, this.container, this.width, this.height);
      return this.layers.push(this.stage);
    };

    Prelude.prototype.initTracks = function() {
      var dir, pos;
      dir = {
        x: -1,
        y: 0
      };
      pos = {
        x: 80,
        y: 30
      };
      this.track_z = new Track(this.stage, dir, pos, 'fc0', this.container, this.width, this.height);
      this.track_z.setActions(Actions.Z);
      dir = {
        x: 0,
        y: -1
      };
      pos = {
        x: 20,
        y: 42
      };
      this.track_n = new Track(this.stage, dir, pos, 'f90', this.container, this.width, this.height);
      this.track_n.setActions(Actions.N);
      dir = {
        x: 0,
        y: -1
      };
      pos = {
        x: 30,
        y: 38
      };
      this.track_a = new Track(this.stage, dir, pos, 'f63', this.container, this.width, this.height);
      this.track_a.setActions(Actions.A);
      dir = {
        x: 0,
        y: 1
      };
      pos = {
        x: 42,
        y: 10
      };
      this.track_k = new Track(this.stage, dir, pos, 'f30', this.container, this.width, this.height);
      this.track_k.setActions(Actions.K);
      dir = {
        x: -1,
        y: 0
      };
      pos = {
        x: 80,
        y: 33
      };
      this.track_e = new Track(this.stage, dir, pos, 'f33', this.container, this.width, this.height);
      this.track_e.setActions(Actions.E);
      this.layers.push(this.track_z);
      this.layers.push(this.track_n);
      this.layers.push(this.track_a);
      this.layers.push(this.track_k);
      return this.layers.push(this.track_e);
    };

    Prelude.prototype.run = function() {
      var update,
        _this = this;
      update = function() {
        var i, _i, _ref, _results;
        _results = [];
        for (i = _i = 0, _ref = _this.layers.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
          if (!_this.layers[i].update()) {
            _this.layers[i] = _this.layers[_this.layers.length - 1];
            _results.push(_this.layers.pop());
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      };
      return this.run_id = setInterval(update, 20);
    };

    Prelude.prototype.stop = function() {
      return clearInterval(this.run_id);
    };

    return Prelude;

  })();

  this.Prelude = Prelude;

}).call(this);
